{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Niri Bar Configuration Schema",
  "description": "Schema for Niri Bar YAML configuration file with YAML anchors and layout profiles",
  "type": "object",
  "properties": {
    "application": {
      "type": "object",
      "description": "Application-level configuration with YAML anchors",
      "properties": {
        "theme": {
          "type": "string",
          "enum": ["wombat", "solarized", "dracula"],
          "default": "wombat",
          "description": "CSS theme to use for styling the bar"
        },
        "modules": {
          "type": "object",
          "description": "Global module defaults (YAML anchors)",
          "additionalProperties": {
            "$ref": "#/definitions/ModuleConfig"
          }
        },
        "layouts": {
          "type": "object",
          "description": "Reusable layout profiles (YAML anchors)",
          "additionalProperties": {
            "$ref": "#/definitions/LayoutConfig"
          }
        },
        "wallpapers": {
          "$ref": "#/definitions/WallpaperConfig",
          "description": "Global wallpaper settings",
          "deprecated": true
        },
        "monitors": {
          "type": "array",
          "description": "Monitor configurations with pattern matching",
          "items": {
            "$ref": "#/definitions/MonitorConfig"
          }
        }
      },
      "required": ["modules", "layouts", "monitors"],
      "additionalProperties": false
    },
    "logging": {
      "$ref": "#/definitions/LoggingConfig"
    }
  },
  "required": ["application", "logging"],
  "definitions": {
    "ModuleConfig": {
      "type": "object",
      "description": "Module configuration with YAML anchor support",
      "properties": {
        "format": {
          "type": "string",
          "description": "Time format string (for clock module)"
        },
        "date_format": {
          "type": ["string", "null"],
          "description": "Deprecated: use 'format' only",
          "deprecated": true
        },
        "tooltip": {
          "type": "boolean",
          "description": "Show tooltip on hover"
        },
        "highlight_active": {
          "type": "boolean",
          "description": "Highlight active workspace (for workspaces module)"
        },
        "show_numbers": {
          "type": "boolean",
          "description": "Show workspace numbers (for workspaces module)"
        },
        "show_wallpaper": {
          "type": "boolean",
          "description": "Show workspace wallpaper thumbnails (for workspaces module)"
        },
        "default_wallpaper": {
          "type": "string",
          "description": "Default wallpaper path used when no workspace-specific image is set"
        },
        "wallpapers": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "Map of workspace index or name to wallpaper path"
        },
        "special_cmd": {
          "type": "string",
          "description": "Override command to set wallpaper; supports ${current_workspace_image} substitution"
        },
        "max_length": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum length for text (for window_title module)"
        },
        "ellipsize": {
          "type": "string",
          "enum": ["start", "middle", "end"],
          "description": "Text ellipsis position"
        },
        "show_percentage": {
          "type": "boolean",
          "description": "Show percentage (for battery module)"
        },
        "warn_threshold": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Warning threshold percentage (for battery module)"
        },
        "critical_threshold": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Critical threshold percentage (for battery module)"
        },
        "cpu": {
          "type": "boolean",
          "description": "Show CPU usage (for system module)"
        },
        "mem": {
          "type": "boolean",
          "description": "Show memory usage (for system module)"
        },
        "net": {
          "type": "boolean",
          "description": "Show network usage (for system module)"
        },
        "enabled": {
          "type": "boolean",
          "description": "Enable/disable module"
        },
        "width": {
          "type": ["integer", "null"],
          "minimum": 20,
          "description": "Fixed width in pixels for modules that support it (viewport)"
        },
        "show_window_titles": {
          "type": "boolean",
          "description": "Show window titles in viewport (for viewport module)",
          "default": true
        },
        "highlight_focused": {
          "type": "boolean",
          "description": "Highlight focused window in viewport (for viewport module)",
          "default": true
        }
      },
      "additionalProperties": true
    },
    "LayoutConfig": {
      "type": "object",
      "description": "Layout configuration with column mapping",
      "properties": {
        "columns": {
          "type": "object",
          "description": "Column mapping with per-column spec",
          "additionalProperties": {
            "$ref": "#/definitions/ColumnSpec"
          }
        }
      },
      "additionalProperties": true
    },
    "ColumnSpec": {
      "type": "object",
      "description": "Per-column modules and overflow policy",
      "properties": {
        "modules": {
          "type": "array",
          "items": { "type": "string" },
          "default": []
        },
        "overflow": {
          "type": "string",
          "enum": ["hide", "kebab", "crop"],
          "default": "hide",
          "description": "Overflow policy (crop alias accepted for hide)"
        }
      },
      "additionalProperties": false
    },
    "MonitorConfig": {
      "type": "object",
      "description": "Monitor configuration with layout and module overrides",
      "properties": {
        "match": {
          "type": "string",
          "description": "Regex pattern to match monitor names"
        },
        "show_bar": {
          "type": "boolean",
          "default": true,
          "description": "Show the bar on this monitor"
        },
        "layout": {
          "$ref": "#/definitions/LayoutConfig",
          "description": "Layout configuration for this monitor"
        },
        "modules": {
          "type": "object",
          "description": "Module configuration overrides for this monitor",
          "additionalProperties": {
            "$ref": "#/definitions/ModuleConfig"
          }
        },
        "wallpapers": {
          "$ref": "#/definitions/WallpaperConfig",
          "description": "Monitor-specific wallpaper settings (overrides global)",
          "deprecated": true
        }
      },
      "required": ["match"],
      "additionalProperties": false
    },
    "WallpaperConfig": {
      "type": "object",
      "description": "Wallpaper configuration with per-workspace mapping",
      "properties": {
        "default": {
          "type": "string",
          "description": "Default wallpaper path used when no workspace-specific image is set"
        },
        "by_workspace": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "Map of workspace index or name to wallpaper path"
        },
        "special_cmd": {
          "type": "string",
          "description": "Override command to set wallpaper; supports ${current_workspace_image} substitution"
        },
        "swww_options": {
          "$ref": "#/definitions/SwwwOptions",
          "description": "Swww-specific options for wallpaper transitions"
        }
      },
      "additionalProperties": false
    },
    "SwwwOptions": {
      "type": "object",
      "description": "Swww-specific options for wallpaper transitions",
      "properties": {
        "transition_type": {
          "type": "string",
          "enum": ["none", "simple", "fade", "left", "right", "top", "bottom", "wipe", "wave", "grow", "center", "any", "outer", "random"],
          "default": "simple",
          "description": "Type of transition effect"
        },
        "transition_duration": {
          "type": "number",
          "minimum": 0.0,
          "default": 1.0,
          "description": "Transition duration in seconds"
        },
        "transition_step": {
          "type": "integer",
          "minimum": 1,
          "maximum": 255,
          "default": 90,
          "description": "Transition step (0-255, higher = faster)"
        },
        "transition_fps": {
          "type": "integer",
          "minimum": 1,
          "default": 30,
          "description": "Frame rate for transition effects"
        },
        "filter": {
          "type": "string",
          "enum": ["Nearest", "Bilinear", "CatmullRom", "Mitchell", "Lanczos3"],
          "default": "Lanczos3",
          "description": "Filter for image scaling"
        },
        "resize": {
          "type": "string",
          "enum": ["no", "crop", "fit", "stretch"],
          "default": "crop",
          "description": "Resize method for images"
        },
        "fill_color": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{6}$",
          "default": "000000",
          "description": "Fill color for padding (hex code without #)"
        }
      },
      "additionalProperties": false
    },
    "LoggingConfig": {
      "type": "object",
      "description": "Logging configuration",
      "properties": {
        "level": {
          "type": "string",
          "enum": ["debug", "info", "warn", "error"],
          "default": "info",
          "description": "Logging level"
        },
        "file": {
          "type": "string",
          "description": "Log file path"
        },
        "console": {
          "type": "boolean",
          "default": true,
          "description": "Enable console logging"
        },
        "format": {
          "type": "string",
          "enum": ["iso8601", "simple"],
          "default": "iso8601",
          "description": "Log format"
        },
        "include_file": {
          "type": "boolean",
          "default": true,
          "description": "Include file name in log messages"
        },
        "include_line": {
          "type": "boolean",
          "default": true,
          "description": "Include line number in log messages"
        },
        "include_class": {
          "type": "boolean",
          "default": true,
          "description": "Include class name in log messages"
        }
      },
      "required": ["level", "file", "console"],
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}